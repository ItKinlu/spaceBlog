# JavaScript 作用域常见面试题

## 面试题

### 作用域

在了解作用域之前，首先需要明白一些基础概念：每一个变量、函数都有其作用的范围，超出作用不得使用，这个叫做作用域。

### 全局变量、局部变量

- 全局变量：
  （1）在全局范围内声明的变量，如;
  （2）只有赋值没有声明的值，如 a=2; （注：如果 a=2 在函数环境中，也是全局变量，没有通过 var 声明的值）
- 局部变量：
  写入函数中的变量，叫做局部变量。
- 作用：
  （1）程序的安全。
  （2）内存的释放。

### 作用域链

查找量的过程。先找自己局部环境有没有声明变量或者是函数，如果有，则查看声明有无赋值或者是函数的内容，如果没有，则向上一级查找，从内部向外部扩散的查找方式。

### 预解析顺序

每个程序都要做的工作，程序开始先预解析语法，标点符号是否有误，解析内存是否可容纳，解析变量……直到解析无误了，才开始按正常的流程顺序走。试想一下，如果没有预解析顺序，直接按流程顺序走，可能程序执行到最后一个函数，发现了语法错误，才开始报错，那性能要有多差啊！

顺序内容： 1.文件内引用的`<script>`块依次解析，从上到下连成一片。 2.每个 script 块内部的 var（注意：只解析变量名，不解析值，如 var a=2;将 var a 解析在环境的开头，并不解析后面的值，只有当程序执行到 var a=2 这行时，才会给变量赋值），function 解析到本块的开头。 3.依次解析每个环境，将 var,function 解析到环境的开头。

### 面试题

- 01

  ```js
  var a = "aa";
  function test() {
    // undefined 当函数执行后，在函数环境内，var a会预解析，当弹出a时，首先先找本层环境内有无声明，发现a变量声明
    // 预解析a的值为undefined，a在alert() 后面进行到赋值。
    alert(a);
    // var a会预解析在函数开头，执行到这行才进行赋值
    var a = "bb";
    // bb
    alert(a);
  }
  test();
  // "aa" 找全局环境下的声明，找到了var a="aa"
  alert(a);
  ```

- 02

  ```js
  var a = "aa";
  function test() {
    alert(
      a
    ); /*“aa”，函数执行后，在函数环境内，没有找到本层环境关于a的声明，所以开始向上一层环境查找。*/
    a = "bb"; /*执行到这行开始改变全局a的量*/
  }
  test();
  alert(a); /* "bb" 全局环境的a在函数执行时已经被改变*/
  function test() {
    b(); /*函数b会被预解析，因此可以调用，执行了输出1；*/
    var a = 1;
    function b() {
      console.log(1);
      console.log(
        a
      ); /*undefined，a在函数内部被定义了，会预先进行变量提升var a;所以是undefined*/
      var a = 2;
    }
  }
  test();
  ```

### 总结

要搞清楚一个变量的作用域，重点是搞清楚预解析顺序，然后再判断作用域的范围，这些都是有套路可言：先找本层环境有无声明，有的话，看是否进行了赋值；只有声明没有执行赋值，就是 undefined。没有声明也没有赋值的话，就再向上一层查找，直到找到为止。如果所有的执行环境都没有找到，那么控制台就会报错变量找不到。函数的话就更简单了：找本层环境是否有预解析的函数，有的话即可执行。没有的话还是向上查找。
